{% extends "components/base.html" %}

{% block title %}Customer Relationship Management - Adiseware{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-users" aria-hidden="true"></i> Customer Relationship Management</h1>
    <a href="{{ url_for('add_customer') }}" class="btn btn-primary">
        <i class="fas fa-user-plus" aria-hidden="true"></i> Add Customer
    </a>
</div>

{% if customers %}
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover" role="table" aria-label="Customer list">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Phone</th>
                        <th scope="col">Type</th>
                        <th scope="col">Total Purchases</th>
                        <th scope="col">Last Purchase</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for customer in customers %}
                    <tr>
                        <td>{{ customer.name }}</td>
                        <td>{{ customer.email or 'N/A' }}</td>
                        <td>{{ customer.phone or 'N/A' }}</td>
                        <td>{{ customer.customer_type or 'General' }}</td>
                        <td>KSh {{ "%.2f"|format(customer.total_purchases) }}</td>
                        <td>{{ customer.last_purchase|datetime if customer.last_purchase else 'Never' }}</td>
                        <td>
                            <a href="{{ url_for('view_customer', customer_id=customer.id) }}" class="btn btn-sm btn-primary" 
                               aria-label="View {{ customer.name }}'s details">
                                <i class="fas fa-eye" aria-hidden="true"></i> View
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="alert alert-info" role="alert">
    No customers yet. <a href="{{ url_for('add_customer') }}" class="alert-link">Add your first customer</a>.
</div>
{% endif %}
{% endblock %}
